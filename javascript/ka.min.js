!function(){function b(el,type,fn){el.addEventListener?el.addEventListener(type,fn,!1):el.attachEvent("on"+type,fn)}window.fitText=function(el,kompressor,options){function j(el){function n(){var t=el.getBoundingClientRect().width;t?el.style.fontSize=Math.max(Math.min(t/(10*e),parseFloat(i.maxFontSize)),parseFloat(i.minFontSize))+"px":setTimeout(()=>n())}var e=kompressor||1;setTimeout(()=>n()),b(window,"resize",n),b(window,"orientationchange",n)}var i=function(obj,ext){for(var t in ext)ext.hasOwnProperty(t)&&(obj[t]=ext[t]);return obj}({minFontSize:-1/0,maxFontSize:1/0},options);if(el.length)for(var t=0;t<el.length;t++)j(el[t]);else j(el);return el}}();class Vec{x;y;constructor(x=0,y=x){this.x=x,this.y=y,Object.freeze(this)}clone(){return new Vec(this.x,this.y)}equals(other){return this.x===other.x&&this.y===other.y}add(other){return new Vec(this.x+other.x,this.y+other.y)}sub(other){return new Vec(this.x-other.x,this.y-other.y)}mult(other){return"number"==typeof other?new Vec(this.x*other,this.y*other):new Vec(this.x*other.x,this.y*other.y)}div(other){return"number"==typeof other?new Vec(this.x/other,this.y/other):new Vec(this.x/other.x,this.y/other.y)}neg(){return new Vec(-this.x,-this.y)}clamp(lo,hi){return new Vec(Math.min(Math.max(this.x,lo.x),hi.x),Math.min(Math.max(this.y,lo.y),hi.y))}norm(){return this.div(this.length())}length(){return Math.sqrt(this.x**2+this.y**2)}distanceTo(other){return this.sub(other).length()}vectorTo(other){return other.sub(this)}directionTo(other){return this.vectorTo(other).norm()}rotate(rad){return new Vec(this.x*Math.cos(rad)-this.y*Math.sin(rad),this.x*Math.sin(rad)+this.y*Math.cos(rad))}interpolateTo(other){const t=d3.interpolateObject(this,other);return i=>Vec.from(t(i))}static interpolateVecArray(from,to){const t=d3.interpolate(from,to),a=x=>Array.isArray(x)?x.map(e=>a(e)):Vec.from(x);return i=>a(t(i))}static from(object){return"number"==typeof object.x&&"number"==typeof object.y?new Vec(object.x,object.y):new Vec(parseFloat(object.x),parseFloat(object.y))}static parse(x,y=x){return new Vec(parseFloat(x),parseFloat(y))}static rad(deg){return deg*(Math.PI/180)}static deg(rad){return 180*Math.PI/rad}}class OverscrollDetector{target;_callback;_threshold;_touchStart;_scrollStart;constructor(target,callback,threshold=new Vec(0)){this.target=target,this._callback=callback,this._threshold=threshold,this.target.on("touchstart",e=>this._resetPositions(e)),this.target.on("touchmove",e=>this._detectOverscroll(e))}_resetPositions(e){this._touchStart=new Vec(e.touches[0].clientX,e.touches[0].clientY),this._scrollStart=new Vec(this.target.property("scrollLeft"),this.target.property("scrollTop"))}_detectOverscroll(e){var e=new Vec(e.touches[0].clientX,e.touches[0].clientY),t=new Vec(this.target.property("scrollLeft"),this.target.property("scrollTop")),i=t.div(new Vec(this.target.property("scrollWidth")-this.target.property("clientWidth")||1,this.target.property("scrollHeight")-this.target.property("clientHeight")||1)),i=(this._touchStart=new Vec((i.x<=0||1<=i.x?this._touchStart:e).x,(i.y<=0||1<=i.y?this._touchStart:e).y),this._scrollStart=new Vec((0===i.x||1===i.x?this._scrollStart:t).x,(0===i.y||1===i.y?this._scrollStart:t).y),t.sub(this._scrollStart).add(e.sub(this._touchStart)).neg());new Vec(Math.abs(i.x)>this._threshold.x?i.x:0,Math.abs(i.y)>this._threshold.y?i.y:0).equals(new Vec)||this._callback(i)}}class AnimParams{position;size;rotation;constructor(position=null,size=null,rotation=null){this.position=position,this.size=size,this.rotation=rotation,Object.freeze(this)}}class CardAnim{static durationEpsilon=50;selection;startParams;endParams;ease;duration;dependsOn;callback;constructor(selection,startParams,endParams,ease,duration,dependsOn=[],callback=null){let t;if(startParams){if(t=Array.isArray(startParams),endParams&&Array.isArray(endParams)!==t)throw new Error("CardAnim.constructor: startParams and endParams must both be an array, or both objects")}else t=!!endParams&&Array.isArray(endParams);if(t&&(startParams&&selection.size()!==startParams.length||endParams&&selection.size()!==endParams.length))throw new Error("CardAnim.constructor: Assertion 'selection.size () == startParams.length == endParams.length' failed");this.selection=selection,this.startParams=startParams?t?startParams.slice():new Array(selection.size()).fill(startParams):null,this.endParams=endParams?t?endParams.slice():new Array(selection.size()).fill(endParams):null,this.ease=ease,this.duration=duration,this.dependsOn=dependsOn.slice(),this.callback=callback}animate(promises=new Map){if(!promises.has(this)){var t=[];for(const e of this.dependsOn)e.animate(promises),t.push(promises.get(e));promises.set(this,Promise.all(t).then(()=>this._animate()))}return promises}followedBy(anim){return anim.dependsOn.push(this),anim}addDependency(anim){return this.dependsOn.push(anim),this}continueTo(endParams,ease=null,duration=null){return new CardAnim(this.selection,null,endParams,ease??this.ease,duration??this.duration,[this])}singleContinueTo(index,endParams,ease=null,duration=null){return new CardAnim(this.selection.filter((d,i)=>i===index),null,endParams,ease??this.ease,duration??this.duration,[this])}addCallback(f){const t=this.callback;return this.callback=t?()=>{t(),f()}:f,this}_animate(){const i=transform=>Array.from(transform.matchAll(/(\w+)\((.+?)\)/gm)).reduce((agg,[,fn,val])=>({...agg,[fn]:val}),{}),t=selection=>selection.style("transform",function(d){var t=i(this.style.transform),e=d.position??(t.translate3d?Vec.parse.apply(null,t.translate3d.split(",").slice(0,2)):new Vec(0)),d=d.rotation??(t.rotate?parseFloat(t.rotate):0);return`translate3d(${e.x}px,${e.y}px, 0) translate(50%, 50%) rotate(${d}deg) translate(-50%, -50%)`}).style("width",function(d){return d.size?d.size.x+"px":this.style.width}).style("height",function(d){return d.size?d.size.y+"px":this.style.height});return this.startParams&&t(this.selection.data(this.startParams).join().style("transition-duration","0s")),this.endParams&&setTimeout(()=>t(this.selection.data(this.endParams).join().style("transition-property","transform, width, height").style("transition-duration",this.duration+"ms").style("transition-timing-function",this.ease))),new Promise(res=>setTimeout(res,this.duration+CardAnim.durationEpsilon)).then(()=>{this.callback&&this.callback()})}static Delay(selection,ease,duration,dependsOn=[]){return new DelayAnim(selection,ease,duration,dependsOn)}}class DelayAnim extends CardAnim{constructor(selection,ease,duration,dependsOn=[]){super(selection,null,null,ease,duration,dependsOn)}_animate(){return new Promise(res=>setTimeout(res,this.duration)).then(()=>{this.callback&&this.callback()})}}class Line{p1;p2;domMin;domMax;a;b;c;static epsilon=.001;constructor(p1,p2){this._reset(p1,p2)}_reset(p1,p2){this.p1=p1,this.p2=p2,this.a=p1.y-p2.y,this.b=p2.x-p1.x,this.c=p1.x*p2.y-p2.x*p1.y,this.domMin=new Vec(Math.min(p1.x,p2.x),Math.min(p1.y,p2.y)),this.domMax=new Vec(Math.max(p1.x,p2.x),Math.max(p1.y,p2.y))}rotate(center,angle){this._reset(this.p1.sub(center).rotate(angle).add(center),this.p2.sub(center).rotate(angle).add(center))}translate(amount){this._reset(this.p1.add(amount),this.p2.add(amount))}intercept(other){var t=(this.b*other.c-other.b*this.c)/(this.a*other.b-this.b*other.a),e=(this.a*other.c-other.a*this.c)/(this.b*other.a-this.a*other.b);return isFinite(t)&&isFinite(e)&&t>this.domMin.x-Line.epsilon&&t<this.domMax.x+Line.epsilon&&t>other.domMin.x-Line.epsilon&&t<other.domMax.x+Line.epsilon&&e>this.domMin.y-Line.epsilon&&e<this.domMax.y+Line.epsilon&&e>other.domMin.y-Line.epsilon&&e<other.domMax.y+Line.epsilon?new Vec(t,e):null}implicit(point){return this.a*point.x+this.b*point.y+this.c}}class Rect{boarders;center;size;constructor(center,size){this.center=center;size=(this.size=size).div(2);this.boarders=[new Line(center.add(new Vec(-size.x,-size.y)),center.add(new Vec(size.x,-size.y))),new Line(center.add(new Vec(-size.x,size.y)),center.add(new Vec(size.x,size.y))),new Line(center.add(new Vec(-size.x,size.y)),center.add(new Vec(-size.x,-size.y))),new Line(center.add(new Vec(size.x,size.y)),center.add(new Vec(size.x,-size.y)))]}corners(){return[this.boarders[0].p1,this.boarders[0].p2,this.boarders[1].p1,this.boarders[1].p2]}translate(amount){this.center=this.center.add(amount);for(const t of this.boarders)t.translate(amount);return this}rotate(angle){for(const t of this.boarders)t.rotate(this.center,angle);return this}containsPoint(point){return this.boarders[0].implicit(point)*this.boarders[1].implicit(point)<=0&&this.boarders[2].implicit(point)*this.boarders[3].implicit(point)<=0}overlaps(rect){return this.containsPoint(rect.boarders[0].p1)||this.containsPoint(rect.boarders[0].p2)||this.containsPoint(rect.boarders[1].p1)||this.containsPoint(rect.boarders[1].p2)||rect.containsPoint(this.boarders[0].p1)||rect.containsPoint(this.boarders[0].p2)||rect.containsPoint(this.boarders[1].p1)||rect.containsPoint(this.boarders[1].p2)}allIntercepts(rect){if(rect===this)return this.corners();var t=[];for(const i of this.boarders)for(const a of rect.boarders){var e=i.intercept(a);e&&t.push(e)}return t}}class Dealer{_cards;_cardSize;_dealPos;_dealSize;_dealOrigin;constructor(cards,cardSize,dealPos,dealSize,dealOrigin){this._cards=cards,this._cardSize=cardSize,this._dealPos=dealPos,this._dealSize=dealSize,this._dealOrigin=dealOrigin}createAnimation(dealDelay,dealDuration,transJitter=.1,rotJitter=10,iters=10){var a=new Vec(Math.ceil(this._dealSize.x/this._cardSize.x),Math.ceil(this._dealSize.y/this._cardSize.y));if(a.x*a.y>this._cards.size())throw new Error("Dealer.createAnimation: Could not cover the dealer area with the cards provided");var s=a.mult(this._cardSize).sub(this._dealSize).div(a.add(new Vec(1)));const r=new Array(this._cards.size());for(let e=0;e<a.x;++e)for(let t=0;t<a.y;++t)r[a.y*e+t]=new AnimParams(this._dealPos.sub(s).add(this._cardSize.sub(s).mult(new Vec(e,t))),this._cardSize,0);for(let t=a.x*a.y;t<this._cards.size();++t)r[t]=new AnimParams(this._dealPos.add(this._dealSize.sub(this._cardSize).mult(Math.random())),this._cardSize,0);this._generateNoise(r,transJitter,rotJitter,iters);for(let t=a.x*a.y-1;0<t;t--){var e=Math.floor(Math.random()*(t+1));[r[t],r[e]]=[r[e],r[t]]}const n=new Array(this._cards.size());for(let t=0;t<this._cards.size();++t)n[t]=new AnimParams(this._dealOrigin,this._cardSize,0);const t=new Array(this._cards.size());return this._cards.each(function(d,i){t[i]=new CardAnim(d3.select(this),n[i],null,"ease-out",i*dealDelay).continueTo(r[i],"ease-out",dealDuration)}),CardAnim.Delay(this._cards,"ease-out",0,t)}_generateNoise(endParams,transJitter,rotJitter,iters){var i=new Rect(this._dealPos.add(this._dealSize.div(2)),this._dealSize),a=endParams.map(param=>new Rect(param.position.add(this._cardSize.div(2)),this._cardSize)),s=[],r=a.map(_=>[]);for(let e=0;e<a.length;++e){var t={rect1:a[e],rect2:i,points:a[e].allIntercepts(i),oldPoints:null};s.push(t),r[e].push(t);for(let t=e;t<a.length;++t){var n={rect1:a[e],rect2:a[t],points:a[e].allIntercepts(a[t]),oldPoints:null};s.push(n),r[e].push(n),r[t].push(n)}}for(let t=0;t<iters;++t)for(let t=0;t<a.length;++t){var o=()=>2*Math.random()-1,l=new Vec(o(),o()).mult(this._cardSize.x+.5*this._cardSize.y*transJitter).clamp(this._dealPos.sub(a[t].center),this._dealPos.add(this._dealSize).sub(a[t].center)),o=o()*rotJitter;a[t].translate(l).rotate(Vec.rad(o));for(const c of r[t])c.oldPoints=c.points,c.points=c.rect1.allIntercepts(c.rect2);let e=!1;for(const d of s){for(const h of d.points)if(i.containsPoint(h)){let t=!1;for(const p of a)if(t=!(d.rect1===p)&&!(d.rect2===p)&&p.containsPoint(h))break;if(e=!t)break}if(e)break}if(e){a[t].rotate(-Vec.rad(o)).translate(l.neg());for(const u of r[t])u.points=u.oldPoints}else endParams[t]=new AnimParams(endParams[t].position.add(l),endParams[t].size,endParams[t].rotation+o)}}}class CardFaceManager{static cardFlipDelay=150;static cardFlipDuration=400;_cards;constructor(cards){this._cards=cards,this._cards.each(function(){d3.select(this).select(".card-inner").on("click",function(){this.classList.contains("card-inactive")&&(this.style.animation="tilt-shaking 300ms")}).on("animationend",function(){this.style.animation=""})})}flip(numFlips,cardFlipDelay=CardFaceManager.cardFlipDelay,cardFlipDuration=CardFaceManager.cardFlipDuration){this._cards.each(function(d,i){const t=d3.select(this).select(".card-inner");var e=t.select(".card-face"),a=t.select(".card-back");i<numFlips?(a.style("transition","transform "+cardFlipDuration+"ms").style("transition-timing-function","ease").style("transition-delay",i*cardFlipDelay+"ms").style("transform","rotateY(180deg)"),e.style("visibility","visible").style("transition","transform "+cardFlipDuration+"ms").style("transition-timing-function","ease").style("transition-delay",i*cardFlipDelay+"ms").style("transform","rotateY(360deg)")):(e.style("transition","transform "+cardFlipDuration+"ms").style("transition-timing-function","ease").style("transition-delay",i*cardFlipDelay+"ms").style("transform","rotateY(180deg)"),a.style("visibility","visible").style("transition","transform "+cardFlipDuration+"ms").style("transition-timing-function","ease").style("transition-delay",i*cardFlipDelay+"ms").style("transform","rotateY(0deg)")),setTimeout(()=>{t.classed("card-inactive",numFlips<=i).classed("card-active",i<numFlips)},i*cardFlipDelay+cardFlipDuration)})}}class GridManager{static states=Object.freeze({GRID:"GRID",HIDDEN:"HIDDEN"});static mobile=GridManager.mobileCheck();static titleMarginFrac=.05;static titleHeightFrac=.2;static cardOuterMarginFrac=.05;static verticalCardsDesktop=1.1;static verticalCardsMobile=1;static verticalCards=GridManager.mobile?GridManager.verticalCardsMobile:GridManager.verticalCardsDesktop;static dealDelay=80;static dealDuration=400;static initialGridFormationDuration=500;static gridReshuffleDuration=400;static hideShowCardDuration=250;static mobileSmoothingDuration=400;static positionUpdateInterval=1500;_currentScreenSize;_currentGrid;_currentTitle;_animationBusy=!1;_canvas;_cards;_titles;_cardRatio;_cardRatioWithMargin;_cardMarginFrac;_titleRatios;_gridWidthOptions;_setupCallback;_dealer;_currentState;_nextState;constructor(canvas,cards,titles,cardSize,cardMargin,titleSizes,gridWidthOptions,setupCallback){if(this._canvas=canvas,this._titles=titles,this._cards=cards,this._gridWidthOptions=gridWidthOptions.slice().sort((l,r)=>r-l),this._setupCallback=setupCallback,this._cardRatio=cardSize.x/cardSize.y,this._cardRatioWithMargin=(cardSize.x+cardMargin.x)/(cardSize.y+cardMargin.y),this._cardMarginFrac=cardSize.add(cardMargin).div(cardSize),this._titles.size()!==titleSizes.length)throw new Error("GridManager.constructor: titles and titleSizes should be the same length");this._titleRatios=titleSizes.map(size=>size.x/size.y),this._titles=this._titles.data(this._titleRatios).sort((l,r)=>r-l),this._titleRatios.sort((l,r)=>r-l),this._cards.raise(),this._currentScreenSize=GridManager.getScreenSize();canvas=this._calculateLayout(this._currentScreenSize);this._currentGrid=canvas.grid,this._currentTitle=canvas.titleChoice,this._currentState=null,this._nextState=GridManager.states.GRID,this._canvas.style("width",canvas.canvasDimensions.x+"px").style("height",canvas.canvasDimensions.y+"px"),document.scrollingElement.overflowY=this._currentGrid.y<=GridManager.verticalCards?"hidden":"",document.scrollingElement.scrollTop=0,this._titles.style("visibility","hidden"),d3.select(this._titles.nodes()[this._currentTitle]).style("transition-duration","0s").style("left",canvas.titlePos.x+"px").style("top",canvas.titlePos.y+"px").style("width",canvas.titleSize.x+"px").style("height",canvas.titleSize.y+"px"),this._dealer=new Dealer(this._cards,canvas.cardSize,canvas.titlePos,canvas.titleSize,new Vec(-canvas.cardSize.x,canvas.titlePos.y)),this._animationBusy=!0,this._dealer.createAnimation(GridManager.dealDelay,GridManager.dealDuration).addCallback(()=>{d3.select(this._titles.nodes()[this._currentTitle]).style("visibility","visible"),this._animationBusy=!1,this.updatePositions(),window.addEventListener("resize",()=>this.updatePositions()),setInterval(()=>this.updatePositions(),GridManager.positionUpdateInterval)}).animate()}hideCards(){this._nextState=GridManager.states.HIDDEN,this.updatePositions()}showCards(){this._nextState=GridManager.states.GRID,this.updatePositions()}updatePositions(prevAnimationDuration=0){var t=GridManager.getScreenSize();if(!(this._animationBusy||this._nextState===this._currentState&&t.equals(this._currentScreenSize))){this._currentScreenSize=t;const r=this._calculateLayout(this._currentScreenSize),n=!this._currentGrid.equals(r.grid);t=this._currentTitle!==r.titleChoice;const o=d3.select(this._titles.nodes()[r.titleChoice]);var e,i,a,s=d3.select(this._titles.nodes()[this._currentTitle]);if(this._currentState===GridManager.states.HIDDEN?(new CardAnim(this._cards,r.hiddenCardPositions,null,"ease-in-out",0).animate(),this._canvas.style("transition-duration","0s").style("width",r.canvasDimensions.x+"px").style("height",r.canvasDimensions.y+"px"),o.style("transition-duration","0s").style("visibility","visible").style("left",r.titlePos.x+"px").style("top",r.titlePos.y+"px").style("width",r.titleSize.x+"px").style("height",r.titleSize.y+"px")):t&&(a=parseFloat(this._canvas.style("width")),i=parseFloat(s.style("height")),e=parseFloat(s.style("top")),i=new Vec(this._titleRatios[r.titleChoice]*i,i),a=new Vec((a-i.x)/2,e),o.style("transition-duration","0s").style("visibility","visible").style("left",a.x+"px").style("top",a.y+"px").style("width",i.x+"px").style("height",i.y+"px")),t&&s.style("transition-duration","0s").style("visibility","hidden"),this._currentState!==GridManager.states.HIDDEN||this._nextState!==GridManager.states.HIDDEN){this._animationBusy=!0;let t=r.cardPositions,e=GridManager.mobile?GridManager.mobileSmoothingDuration:prevAnimationDuration/2,i="ease-in-out";this._nextState===GridManager.states.HIDDEN?[t,e,i]=[r.hiddenCardPositions,GridManager.hideShowCardDuration,"ease-in"]:this._currentState===GridManager.states.HIDDEN?[e,i]=[GridManager.hideShowCardDuration,"ease-out"]:this._currentState?n&&(e=GridManager.gridReshuffleDuration):e=GridManager.initialGridFormationDuration,this._currentState!==GridManager.states.HIDDEN&&setTimeout(()=>o.style("transition-property","left, top, width, height").style("transition-duration",e+"ms").style("transition-timing-function","ease-in-out").style("left",r.titlePos.x+"px").style("top",r.titlePos.y+"px").style("width",r.titleSize.x+"px").style("height",r.titleSize.y+"px")),new CardAnim(this._cards,null,t,i,e).addCallback(()=>{this._setupCallback&&this._setupCallback(),this._setupCallback=null,n&&GridManager.mobile&&(document.scrollingElement.scrollTop=0),document.scrollingElement.overflowY=r.grid.y<=GridManager.verticalCards?"hidden":"",this._animationBusy=!1,this.updatePositions(e)}).animate(),setTimeout(()=>this._canvas.style("transition-property","width, height").style("transition-duration",e+"ms").style("transition-timing-function","ease-in-out").style("width",r.canvasDimensions.x+"px").style("height",r.canvasDimensions.y+"px"))}this._currentState=this._nextState,this._currentGrid=r.grid,this._currentTitle=r.titleChoice}}_calculateLayout(screenSize,hiddenCardPositionJitter=1,hiddenCardAngleJitter=45){var i=this._calculateGrid(screenSize),t=screenSize.y*(1-GridManager.titleHeightFrac-2*GridManager.cardOuterMarginFrac-2*GridManager.titleMarginFrac)/GridManager.verticalCards,a=new Vec(this._cardRatioWithMargin*t,t),s=a.div(this._cardMarginFrac),t=a.sub(s),r=new Vec((screenSize.x-i.x*a.x+t.x)/2,screenSize.y*(GridManager.titleHeightFrac+GridManager.cardOuterMarginFrac+2*GridManager.titleMarginFrac)+t.y/2),n=[];for(let e=0;e<i.y;++e)for(let t=0;t<i.x&&e*i.x+t<this._cards.size();++t)n.push(new AnimParams(r.add(a.mult(new Vec(t,e))),s,0));var t=new Vec(screenSize.x,screenSize.y*(GridManager.titleHeightFrac+2*GridManager.titleMarginFrac+2*GridManager.cardOuterMarginFrac)+a.y*i.y),e=screenSize.y*GridManager.titleHeightFrac,o=screenSize.x/e;let l=null;for(let t=0;t<this._titleRatios.length&&null===l;++t)(this._titleRatios[t]<o||t===this._titleRatios.length-1)&&(l=t);var e=new Vec(this._titleRatios[l]*e,e),screenSize=new Vec((screenSize.x-e.x)/2,screenSize.y*GridManager.titleMarginFrac),c=i.x>i.y,d=Math.sqrt(s.x**2+s.y**2),h=c?[new Vec(0,-d).interpolateTo(new Vec(t.x-s.x,-d)),new Vec(0,t.y+d-s.y).interpolateTo(new Vec(t.x-s.x,t.y+d-s.y))]:[new Vec(-d,0).interpolateTo(new Vec(-d,t.y-s.y)),new Vec(t.x+d-s.x,0).interpolateTo(new Vec(t.x+d-s.x,t.y-s.y))],p=[];for(let e=0;e<i.y;++e)for(let t=0;t<i.x&&e*i.x+t<this._cards.size();++t){var u=e*i.x+t,m=c?e>i.y/2-.5+.1*(-1)**t:t>i.x/2-.5+.1*(-1)**e,y=c?t/(i.x-1):e/(i.y-1),g=()=>2*Math.random()-1,_=new Vec(hiddenCardPositionJitter*(s.x+s.y)*.5*g()).mult(new Vec(c?1:0,c?0:1)),g=hiddenCardAngleJitter*g();p[u]=new AnimParams(h[m?1:0](y).add(_),s,g)}return{grid:i,cardSize:s,canvasDimensions:t,cardPositions:n,hiddenCardPositions:p,titleChoice:l,titleSize:e,titlePos:screenSize}}_calculateGrid(screenSize){var t=screenSize.x/screenSize.y/(1-GridManager.titleHeightFrac-2*GridManager.cardOuterMarginFrac-2*GridManager.titleMarginFrac)*GridManager.verticalCards/this._cardRatioWithMargin;for(const e of this._gridWidthOptions)if(e<=t)return new Vec(e,Math.ceil(this._cards.size()/e));screenSize=this._gridWidthOptions[this._gridWidthOptions.length-1];return new Vec(screenSize,Math.ceil(this._cards.size()/screenSize))}static mobileCheck(){let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?!0:t}static getScreenSize(){return new Vec(window.innerWidth,window.innerHeight)}}class PopupManager{static states=Object.freeze({CLOSED:"CLOSED",OPEN:"OPEN"});static animationDuration=500;static backgroundBlur=4;static overscrollCloseAmount=100;_gridManager;_overscrollDetector;_canvas;_popup;_popupClose;_currentState;_nextState;_nextContents=null;_animationBusy=!1;constructor(canvas,popup,popupClose,gridManager){this._canvas=canvas,this._popup=popup,this._popupClose=popupClose,this._gridManager=gridManager,this._currentState=this._nextState=PopupManager.states.CLOSED,GridManager.mobile&&(this._overscrollDetector=new OverscrollDetector(this._canvas,overscroll=>{this._currentState===PopupManager.states.OPEN&&overscroll.y<0&&this.closePopup()},new Vec(1/0,PopupManager.overscrollCloseAmount))),this._popupClose.on("click",()=>this.closePopup())}openPopup(contents){this._nextContents=contents,this._nextState=PopupManager.states.OPEN,this._transitionPopup()}closePopup(){this._nextState=PopupManager.states.CLOSED,this._transitionPopup()}_transitionPopup(){if(!this._animationBusy){if(this._nextContents){for(;this._popup.node().firstChild;)this._popup.node().removeChild(this._popup.node().lastChild);this._popup.node().appendChild(this._nextContents),this._nextContents=null}this._nextState!==this._currentState&&(setTimeout(()=>this._canvas.style("visibility","visible").style("transition","top").style("transition-duration",PopupManager.animationDuration+"ms").style("top",this._nextState===PopupManager.states.OPEN?"0":"100%")),setTimeout(()=>this._popupClose.style("transition","transform").style("transition-duration",PopupManager.animationDuration+"ms").style("transition-delay",(this._nextState===PopupManager.states.OPEN?PopupManager.animationDuration/2:0)+"ms").style("transform",this._nextState===PopupManager.states.OPEN?"translate(0,-100%)":"translate(0,0)")),this._nextState===PopupManager.states.CLOSED?(this._gridManager.showCards(),this._canvas.style("overflow","hidden")):(this._gridManager.hideCards(),document.scrollingElement.style.overflowY="hidden"),0<this._canvas.node().scrollTop&&this._canvas.node().scrollTo(0,0),setTimeout(()=>this._gridManager._canvas.style("transition","filter").style("transition-duration",PopupManager.animationDuration+"ms").style("filter","blur("+(this._nextState===PopupManager.states.CLOSED?0:PopupManager.backgroundBlur)+"px)")),this._animationBusy=!0,this._currentState=this._nextState,setTimeout(()=>{this._currentState===PopupManager.states.CLOSED?(this._canvas.style("visibility","hidden"),document.scrollingElement.style.overflowY="auto"):this._canvas.style("overflow","auto"),this._animationBusy=!1,this._transitionPopup()},PopupManager.animationDuration))}}}