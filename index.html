<!doctype html>
<html lang="" style="width: 100%; height: 100%; margin: 0">
	<head>
		<title>Base Page</title>
		<script src="https://d3js.org/d3.v7.min.js"></script>
		<script src="javascript/Vec.js" ></script>
		<script src="javascript/Animations.js" ></script>
		<script src="javascript/Dealer.js" ></script>
		<script src="javascript/Card.js"></script>
		<script src="javascript/GridManager.js" ></script>

		<link rel="stylesheet" href="css/card.css"/>
	</head>

	<body style="width: 100%; height: 100%; margin: 0; overflow-x: hidden">

		<!--
		<svg viewBox="0 0 1000 1000">
			<image id="duck1" class="duck" href="assets/duck.jpg" width="100" style="transform-box: fill-box; transform-origin: center"/>
			<image id="duck2" class="duck" href="assets/duck.jpg" width="100" style="transform-box: fill-box; transform-origin: center"/>
		</svg>
		-->

		<svg id="svg" viewBox="0 0 0 0" style="position: absolute; left: 50%; transform: translate(-50%, 0)" requiredExtensions="http://www.w3.org/1999/xhtml" >

			<image class="title" href="assets/title3.jpg" width="100" height="100"></image>
			<image class="title" href="assets/title5.jpg" width="100" height="100"></image>
			<image class="title" href="assets/title12.jpg" width="100" height="100"></image>

		</svg>

		<script>

			let cm;

			const onload1 = () =>
			{
				let pparams1 = [ new AnimParams ( null, new Vec ( 50 ), null ),  new AnimParams ( null, new Vec ( 50 ), null ) ];
				let pparams2 = [ new AnimParams ( null, new Vec ( 80 ), 90 ),  new AnimParams ( null, new Vec ( 20 ), 90 ) ];

				let params1 = new AnimParams ( null, null, 180 );
				let params2 = new AnimParams ( new Vec ( 500, 400 ), null, 359 );
				let params3 = new AnimParams ( new Vec ( 100, 200 ), null, 420 );

				let sanim = CardAnim.Setup ( d3.selectAll ( ".duck" ), d3.easeSin, 1000 )
					.continueTo ( pparams1 )
					.continueTo ( pparams2 )
					.addCallback ( () => console.log ( "callback 1" ) )
					.addCallback ( () => console.log ( "callback 2" ) )
					.singleContinueTo ( 0, params1 )
					.continueTo ( params2 )
					.continueTo ( params3 );

				sanim.animate();
			};

			const onload2 = () =>
			{
				const dealSize = new Vec ( 400, 150 );
				const dealPos = new Vec ( 200, 100 );
				const cardSize = new Vec ( 87, 122 ).mult ( 1.5 );

				/*
				d3.select ( "#svg" ).append ( "rect" )
					.attr ( "x", dealPos.x )
					.attr ( "y", dealPos.y )
					.attr ( "width", dealSize.x )
					.attr ( "height", dealSize.y );
				 */

				const cards = [];
				for ( let i = 0; i < 8; ++i )
					cards.push ( new Card (
						d3.select ( "#svg" ),
						"assets/card.jpeg",
						cardSize
					) );

				cm = new GridManager (
					d3.select ( "#svg" ),
					d3.selectAll ( ".card" ),
					d3.selectAll ( ".title" ),
					cardSize,
					cardSize.mult ( new Vec ( 0.65, 0.2 ) ),
					[ new Vec ( 3, 1 ), new Vec ( 5, 1 ), new Vec ( 12, 1 ) ],
					[ 1, 2, 4 ],
					() => console.log ( "setup done" ) );

				cards [ 0 ].card.on ( "click", () =>
				{
					cm.hideCards ();
					setTimeout ( () => cm.showCards (), 2000 );
				} )
			}

			window.onload = onload2;

		</script>

	</body>
</html>